import type { DecisionTree } from "../decision/decisionTree";

export const chapter2_tree: DecisionTree = {
  id: "ch2",
  title: "Глава 2 — Методы ликвидации аварий: выбор ветки и план работ",
  startNodeId: "q_before_start",
  nodes: {
    q_before_start: {
      id: "q_before_start",
      type: "question",
      title: "Проведён анализ аварии (что, где, чем ловить, риски)?",
      help: "В книге подчёркнуто: до ликвидации нужно тщательно проанализировать аварию; неверный инструмент может усугубить ситуацию.",
      input: "yesno",
      edges: [
        { when: { eq: true }, to: "q_type", label: "да" },
        { when: { eq: false }, to: "r_analyze_first", label: "нет" },
      ],
    },

    r_analyze_first: {
      id: "r_analyze_first",
      type: "result",
      severity: "high",
      title: "Сначала анализ — потом ликвидация",
      actions: [
        "Собрать факты: глубина/интервал, компоновка, что осталось в скважине, режимы, циркуляция, давления/нагрузки.",
        "Определить цель: освободить колонну / извлечь оставшийся предмет / восстановить проходимость / изоляция.",
        "Подобрать диагностический инструмент при необходимости (печать, прихватоопределитель и т.п.).",
        "Только после этого выбирать ловильный инструмент и метод.",
      ],
      notes: ["Если нет уверенности — эскалировать старшему инженеру/мастеру по сложным работам."],
      references: [{ chapter: "Гл.2", section: "общие положения" }],
    },

    q_type: {
      id: "q_type",
      type: "question",
      title: "Какой раздел ликвидации подходит?",
      input: "select",
      options: [
        { value: "2_1", label: "2.1 Бурильная колонна" },
        { value: "2_2", label: "2.2 Обсадная колонна (спуск/крепление)" },
        { value: "2_3", label: "2.3 Турбобуры и турбодолота" },
        { value: "2_4", label: "2.4 Долота" },
        { value: "2_5", label: "2.5 Посторонние предметы" },
        { value: "2_6", label: "2.6 Прочие аварии" },
        { value: "2_7", label: "2.7 Техника безопасности" },
      ],
      edges: [
        { when: { eq: "2_1" }, to: "r_2_1" },
        { when: { eq: "2_2" }, to: "r_2_2" },
        { when: { eq: "2_3" }, to: "r_2_3" },
        { when: { eq: "2_4" }, to: "r_2_4" },
        { when: { eq: "2_5" }, to: "r_2_5" },
        { when: { eq: "2_6" }, to: "r_2_6" },
        { when: { eq: "2_7" }, to: "r_2_7" },
      ],
    },

    r_2_1: {
      id: "r_2_1",
      type: "result",
      severity: "high",
      title: "2.1 Ликвидация аварий с бурильной колонной — общий план",
      actions: [
        "Уточнить характер: обрыв/срыв по резьбе/падение секции/деформация/заклинивание.",
        "Выполнить подготовку ловильных работ: эскиз компоновки, исключить 'узкие' переводники, проверить СПО и ключи, обеспечить надежное крепление соединений.",
        "Выбрать ловильный инструмент (колокол/метчик/труболовка/фрезер/магнитный ловитель) по результатам диагностики.",
        "Провести ловильную операцию с контролем нагрузки/крутящего момента/циркуляции.",
        "При неуспехе: сменить инструмент/тактику, рассмотреть фрезерование, резку, торпедирование (если предусмотрено).",
      ],
      references: [{ chapter: "Гл.2", section: "2.1" }, { chapter: "Гл.4", section: "подбор ловильного инструмента" }],
    },

    r_2_2: {
      id: "r_2_2",
      type: "result",
      severity: "high",
      title: "2.2 Аварии при спуске и креплении обсадных колонн — общий план",
      actions: [
        "Определить вид: прихват обсадной, падение труб/секций, смятие, разрушение резьб, протирание и т.п.",
        "Стабилизировать ствол и режимы (промывка, контроль уровня/долива, исключение резких посадок).",
        "Решение: освободить колонну (осевые/вращательные воздействия по допускаемым нагрузкам), или извлечь/разрезать/перекрыть интервал (по проекту).",
        "При необходимости применить специальные ловильные приспособления и фрезерование, труборезки, печати.",
      ],
      references: [{ chapter: "Гл.2", section: "2.2" }, { chapter: "Гл.1", section: "1.4" }],
    },

    r_2_3: {
      id: "r_2_3",
      type: "result",
      severity: "high",
      title: "2.3 Аварии с турбобурами и турбодолотами — общий план",
      actions: [
        "Подтвердить наличие/положение двигателя, состояние посадочных мест.",
        "Применить специализированные ловители для турбобуров (см. главу 4.15) и диагностический инструмент (печати).",
        "При необходимости — фрезерование/обработка торца, обеспечение центровки ловильного инструмента.",
        "Контроль: циркуляция, крутящий момент, посадка/вход ловителя.",
      ],
      references: [{ chapter: "Гл.2", section: "2.3" }, { chapter: "Гл.4", section: "4.15" }],
    },

    r_2_4: {
      id: "r_2_4",
      type: "result",
      severity: "high",
      title: "2.4 Аварии с долотами — общий план",
      actions: [
        "Определить: отрыв долота, разрушение, оставление частей.",
        "Диагностика печатью/ловителем; оценить необходимость фрезерования.",
        "Выбрать ловитель/колокол/метчик (если есть резьбовой захват), либо магнитный ловитель/устройства удаления мелкого металла.",
        "Провести извлечение с контролем параметров.",
      ],
      references: [{ chapter: "Гл.2", section: "2.4" }, { chapter: "Гл.4", section: "4.2–4.9" }],
    },

    r_2_5: {
      id: "r_2_5",
      type: "result",
      severity: "medium",
      title: "2.5 Освобождение скважины от посторонних предметов — общий план",
      actions: [
        "Оценить характер предмета: мелкий металл/крупный предмет/обломки пород.",
        "Применить магнитные фрезеры‑ловители, ерши и устройства удаления мелких предметов (гл. 4.8–4.9, 4.17).",
        "При заклинивании породой — стабилизировать стенки (раствор/режим), затем механическая очистка/фрезерование по возможности.",
      ],
      references: [{ chapter: "Гл.2", section: "2.5" }, { chapter: "Гл.4", section: "4.8–4.9, 4.17" }],
    },

    r_2_6: {
      id: "r_2_6",
      type: "result",
      severity: "medium",
      title: "2.6 Ликвидация прочих аварий — общий план",
      actions: [
        "Классифицировать событие и цель: извлечь / восстановить проходимость / устранить осложнение.",
        "Применить диагностические средства (печать, прихватоопределитель) и затем подобрать ловильный/фрезерный/режущий инструмент.",
        "Если авария длительная — оформлять решения и эскалировать по регламенту предприятия.",
      ],
      references: [{ chapter: "Гл.2", section: "2.6" }, { chapter: "Гл.4", section: "4.13–4.14" }],
    },

    r_2_7: {
      id: "r_2_7",
      type: "result",
      severity: "high",
      title: "2.7 Техника безопасности при ликвидации аварий — чек‑лист",
      actions: [
        "Назначить ответственного руководителя работ (старший по должности).",
        "Ограничить опасную зону: удалить посторонних людей, обеспечить связь и освещение.",
        "Проверить исправность СПО‑оборудования, ключей, стропов, тормозов, предохранителей.",
        "Работать только в СИЗ; соблюдать порядок команд и сигналов.",
        "Не превышать допускаемые нагрузки/давления; фиксировать все изменения режима.",
      ],
      notes: ["Этот чек‑лист — стартовый; дополняйте местными правилами и ПБ предприятия."],
      references: [{ chapter: "Гл.2", section: "2.7" }],
    },
  },
};
