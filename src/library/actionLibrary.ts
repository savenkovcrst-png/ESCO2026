export type ActionStep = {
  text: string;
  check?: string; // как проверить выполнение
};

export type ActionPack = {
  id: string;
  title: string;
  whenToUse: string;
  steps: ActionStep[];
  safety?: string[];
  tools?: string[];
  notes?: string[];
  source?: string; // ссылка на раздел книги/заметки
};

export const ACTION_LIBRARY: Record<string, ActionPack> = {
  // ====== Универсальные пакеты (для любой аварии) ======
  "initial_response": {
    id: "initial_response",
    title: "Первые действия при подозрении на аварию",
    whenToUse: "Любая нештатная ситуация в скважине.",
    steps: [
      { text: "Зафиксировать текущие параметры: вес/крутящий момент/давление/расход/глубина/нагрузка/оборот.", check: "Параметры записаны." },
      { text: "Остановить усугубляющие действия: не давать резких посадок/рывков, исключить вращение при подозрении на обрыв/прихват (до анализа).", check: "Режим стабилизирован." },
      { text: "Сообщить руководителю работ (мастер/старший инженер) и назначить ответственного.", check: "Ответственный назначен." },
      { text: "Сделать экспресс-анализ: что изменилось? (вес/давление/мех.скорость/провалы/циркуляция).", check: "Гипотеза причины сформулирована." },
      { text: "Выбрать ветку карты решений (тип инцидента) и подготовить план действий.", check: "Выбран сценарий и план." },
    ],
    notes: [
      "Логика: сначала анализ и правильный выбор метода/инструмента, затем выполнение. Это снижает риск осложнений.",
    ],
    source: "Глава 2 (общие принципы ликвидации аварий)",
  },

  "safety_check": {
    id: "safety_check",
    title: "ТБ при ликвидации аварий: обязательный чек",
    whenToUse: "Любые ловильные/аварийные работы.",
    steps: [
      { text: "Проверить талевую систему/канат/крюк/вертлюг/крепления/тормоза лебёдки.", check: "Проверка выполнена." },
      { text: "Проверить исправность индикатора веса и регистрации параметров.", check: "Показания стабильны." },
      { text: "Проверить шланги/соединения/нагнетательную линию.", check: "Протечек нет." },
      { text: "Перед спуском ловильного инструмента провести инструктаж бригады.", check: "Инструктаж проведён." },
    ],
    safety: [
      "СИЗ по условиям работ (кислоты/реагенты/взрывные работы — отдельные правила).",
    ],
    source: "Глава 2.7 (техника безопасности)",
  },

  // ====== Ловильные работы (подготовка) ======
  "fishing_prepare": {
    id: "fishing_prepare",
    title: "Подготовка к ловильным работам (до спуска инструмента)",
    whenToUse: "Перед любыми ловильными работами.",
    steps: [
      { text: "Составить эскиз компоновки ловильного инструмента с размерами.", check: "Эскиз готов." },
      { text: "Исключить переводники/сечения, ограничивающие проход.", check: "Ограничений нет." },
      { text: "Проверить исправность СПО и ключей, затяжку замков.", check: "Соединения затянуты по регламенту." },
      { text: "Подобрать компоновку так, чтобы инструмент крепился ротором; в превенторе — бурильная труба; в роторе — ведущая.", check: "Условие выполнено." },
      { text: "Применять центрирование ловильного инструмента при малых зазорах/риске задевания.", check: "Центратор установлен или не требуется." },
    ],
    tools: ["Ловитель/колокол/труболовка/метчик/магнитный ловитель (по сценарию)", "Центратор"],
    source: "Глава 2.1 (подготовка к ловильным работам)",
  },

  // ====== Примерные пакеты по типам инцидентов (добавляйте по книге) ======
  "drillstring_failure_signs": {
    id: "drillstring_failure_signs",
    title: "Признаки аварии бурильной колонны",
    whenToUse: "Подозрение на обрыв/поломку БК.",
    steps: [
      { text: "Сравнить изменения веса (индикатор веса) с нормой для текущей глубины.", check: "Отклонения подтверждены." },
      { text: "Оценить давление/расход: есть ли резкое падение давления в нагнетательной линии.", check: "Падение есть/нет." },
      { text: "Оценить мех.скорость и 'провалы' колонны.", check: "Симптомы зафиксированы." },
      { text: "Снять контрольные значения на подъёме (без резких действий).", check: "Контроль выполнен." },
    ],
    source: "Глава 2.1 (признаки аварий с БК)",
  },

  "choose_fishing_tool_basic": {
    id: "choose_fishing_tool_basic",
    title: "Выбор ловильного инструмента (базовые правила)",
    whenToUse: "Нужно извлечь оставшийся инструмент/часть колонны.",
    steps: [
      { text: "Определить тип 'головки' (конец/профиль/резьба/деформация).", check: "Тип конца определён." },
      { text: "Приоритет: наружный захват (колокол/наружная труболовка/ловитель) + центрирование при необходимости.", check: "Инструмент выбран." },
      { text: "По возможности применять освобождающиеся инструменты.", check: "Инструмент допускает освобождение." },
      { text: "Не использовать заведомо рискованные варианты (метчик без центрирования и т.п.).", check: "Риски исключены." },
    ],
    source: "Глава 2.1.1 (извлечение неприхваченной части БК)",
  },

  "losses_mix_requirements": {
    id: "losses_mix_requirements",
    title: "Требования к смесям для изоляции поглощений",
    whenToUse: "Подбор состава для изоляции зоны поглощения.",
    steps: [
      { text: "Смесь должна сохранять текучесть на период закачивания/продавки.", check: "Время текучести соответствует." },
      { text: "Плотность смеси близка к плотности бурового раствора.", check: "Плотности согласованы." },
      { text: "Сроки схватывания с запасом относительно времени операции.", check: "Сроки заданы." },
      { text: "Устойчивость к температуре/давлению и разбавлению пластовыми водами.", check: "Устойчивость учтена." },
    ],
    source: "Глава 5.5 (тампонажные смеси)",
  },
};
