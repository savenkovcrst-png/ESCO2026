// src/library/actionLibrary.ts
export type ActionStep = {
  text: string;
  check?: string; // как понять, что шаг выполнен/результат достигнут
};

export type ActionPack = {
  id: string;
  title: string;
  whenToUse: string; // когда применяем
  steps: ActionStep[];
  safety?: string[]; // ТБ/СИЗ
  tools?: string[]; // инструмент/оборудование
  notes?: string[]; // важные замечания
  source?: string; // ссылка на раздел книги (чтобы вам было удобно)
};

export const ACTION_LIBRARY: Record<string, ActionPack> = {
  // ============ ГЛАВА 2 (общая логика ликвидации) ============
  "ch2_initial_response": {
    id: "ch2_initial_response",
    title: "Первые действия при подозрении на поломку/аварию",
    whenToUse: "Любая аварийная ситуация в скважине (подозрение на поломку инструмента/колонны).",
    steps: [
      { text: "Немедленно начать подъём бурильной колонны.", check: "Подъём начат, режим контролируемый." },
      { text: "Не прекращая основных работ, уведомить мастера (или руководство при отсутствии мастера).", check: "Факт уведомления зафиксирован." },
      { text: "Остановиться и провести анализ аварии перед выбором метода/инструмента.", check: "Сформулирована гипотеза причины + выбран план." },
      { text: "Назначить ответственного руководителя работ (старший по должности).", check: "Есть ответственное лицо, команда проинструктирована." },
    ],
    notes: [
      "Книга подчёркивает: неверный выбор ловильного инструмента часто усложняет аварию и может привести к ликвидации скважины.",
    ],
    source: "Гл.2 (вводная часть к методам ликвидации аварий)",
  },

  "ch2_fishing_prepare": {
    id: "ch2_fishing_prepare",
    title: "Подготовка к ловильным работам (до спуска инструмента)",
    whenToUse: "Перед любыми ловильными работами/спуском ловильного инструмента.",
    steps: [
      { text: "Составить эскиз компоновки ловильного инструмента с основными размерами.", check: "Эскиз готов и сохранён." },
      { text: "Убрать из колонны переводники с уменьшенным проходным сечением.", check: "Колонна подготовлена, ограничения потока исключены." },
      { text: "Проверить талевый канат и СПО-оборудование.", check: "Проверка проведена, дефекты устранены." },
      { text: "Проверить крепление штропа вертлюга в зеве крюка.", check: "Крепление надёжное." },
      { text: "Все замковые соединения крепить машинными/автоматическими ключами.", check: "Соединения затянуты по регламенту." },
      { text: "Подобрать длину колонны так, чтобы ловильный инструмент крепился ротором; в плашках превентора — бурильная труба; в роторе — ведущая.", check: "Компоновка соответствует требованию." },
    ],
    source: "Гл.2.1 (подготовка к ловильным работам)",
  },

  // ============ ГЛАВА 2.1 (бурильная колонна) ============
  "ch2_1_signs_drillstring_failure": {
    id: "ch2_1_signs_drillstring_failure",
    title: "Признаки аварии с бурильной колонной",
    whenToUse: "Если подозрение на слом/аварию бурильной колонны.",
    steps: [
      { text: "Оценить изменение показаний индикатора веса (уменьшение/увеличение в зависимости от зоны слома).", check: "Есть вывод: растянутая/сжатая часть." },
      { text: "Проверить падение давления промывочной жидкости в нагнетательной линии.", check: "Факт падения подтверждён/опровергнут." },
      { text: "Оценить падение механической скорости проходки и ‘провалы’ колонны.", check: "Симптомы зафиксированы." },
      { text: "Для сравнения веса при изменении показаний — приподнять бурильную колонну.", check: "Сняты контрольные значения." },
    ],
    source: "Гл.2.1 (признаки аварии с БК)",
  },

  "ch2_1_choose_fishing_tool": {
    id: "ch2_1_choose_fishing_tool",
    title: "Выбор ловильного инструмента при извлечении неприхваченной части БК",
    whenToUse: "Нужно поднять неприхваченную часть труб после слома.",
    steps: [
      { text: "Оценить характер слома и состояние скважины.", check: "Определён тип конца/конфигурация излома." },
      { text: "Сначала предпочесть наружные ловильные инструменты (ловители/наружные труболовки/колокола), желательно с центрирующими приспособлениями.", check: "Выбран инструмент наружного захвата." },
      { text: "Предпочтение отдавать освобождающимся ловильным инструментам.", check: "Инструмент допускает освобождение." },
      { text: "Не применять ловители, если вес оставшихся труб превышает допустимую нагрузку или конец сильно разорван/сложный.", check: "Ограничения учтены." },
      { text: "Не спускать ловильный инструмент без центрирующего приспособления при недостаточной сумме диаметров относительно скважины.", check: "Центратор установлен/условие исключено." },
    ],
    notes: [
      "В книге отдельно подчёркнута порочная практика спуска метчиков без центрирующих — частая причина осложнений.",
    ],
    source: "Гл.2.1.1 (извлечение неприхваченной части БК)",
  },

  // ============ ГЛАВА 2.2 (обсадные колонны) ============
  "ch2_2_casing_stuck": {
    id: "ch2_2_casing_stuck",
    title: "Прихват обсадной колонны: последовательность действий",
    whenToUse: "При прихвате обсадной колонны при спуске/креплении.",
    steps: [
      { text: "Восстановить интенсивную циркуляцию промывочной жидкости.", check: "Циркуляция восстановлена/увеличена." },
      { text: "Одновременно расхаживать колонну без резких посадок.", check: "Есть режим расхаживания." },
      { text: "Усилие натяжки держать на 50–100 кН выше веса колонны до прихвата.", check: "Усилие контролируется по индикатору." },
      { text: "Если не помогает — цементировать колонну в месте вынужденной остановки.", check: "Принято решение и оформлено." },
      { text: "Если остановка равносильна ликвидации скважины — вести длительные работы: ванна/сплошная промывка нефтью или кислотой.", check: "Выбран метод и план." },
      { text: "Если циркуляция прекратилась — восстановить через отверстия выше стоп-кольца: прострелить 15–20 отверстий.", check: "Циркуляция через отверстия восстановлена." },
    ],
    source: "Гл.2.2 (аварии при спуске и креплении обсадных колонн)",
  },

  // ============ ГЛАВА 2.3 (турбобуры/турбодолота) ============
  "ch2_3_turbodrill_accident": {
    id: "ch2_3_turbodrill_accident",
    title: "Авария с турбобуром/турбодолото: выбор захвата и порядок",
    whenToUse: "Резкое падение давления промывочной жидкости (почти без потери веса) и др. признаки аварии турбобура.",
    steps: [
      { text: "При срыве замковой резьбы верхнего переводника — спустить ловитель или труболовку.", check: "Выбран инструмент и начат спуск." },
      { text: "Если резьба замковой муфты в хорошем состоянии — применить метчик-калибр или новый замковый ниппель для соединения.", check: "Соединение выполнено/попытка сделана." },
      { text: "Всегда учитывать необходимость центрирующих приспособлений при соответствующих условиях.", check: "Центратор установлен при необходимости." },
      { text: "При срыве резьбы переводник–корпус/межсекционной — спустить резьбовой калибр или новый переводник (если доступ к резьбе открыт и она не нарушена).", check: "Условия проверены и выбран вариант." },
      { text: "Если позволяет диаметр — использовать трубную ловушку (отрезок обсадной трубы с вмятинами) или ловитель конструкции Алянчикова.", check: "Инструмент подобран под диаметр и профиль." },
    ],
    source: "Гл.2.3 (ликвидация аварий с турбобурами и турбодолотами)",
  },

  // ============ ГЛАВА 2.5 (посторонние предметы) ============
  "ch2_5_foreign_objects": {
    id: "ch2_5_foreign_objects",
    title: "Освобождение скважины от посторонних предметов",
    whenToUse: "В скважину упал посторонний предмет/металлолом на забое.",
    steps: [
      { text: "Подобрать ловильный инструмент по размеру и форме предмета.", check: "Подбор выполнен." },
      { text: "Если предмет помещается в гидромеханический ‘паук’ — стараться извлечь им.", check: "Попытка выполнена." },
      { text: "Использовать магнитный фрезер по размеру/весу предмета.", check: "Применимость оценена." },
      { text: "Крупные предметы (клинья, части ключей) — разрушать забойными/башмачными фрезерами; при необходимости — с коронкой, присоединённой к магнитному фрезеру.", check: "Выбран метод разрушения/добычи." },
      { text: "Периодически очищать забой от мелких металлических предметов: магнитный фрезер + шламометаллоулавливатель или эжекторный металлоулавливатель.", check: "Очистка выполнена." },
    ],
    source: "Гл.2.5 (посторонние предметы)",
  },

  // ============ ГЛАВА 2.7 (ТБ) ============
  "ch2_7_safety_basics": {
    id: "ch2_7_safety_basics",
    title: "Техника безопасности при ликвидации аварий: обязательные проверки",
    whenToUse: "Всегда при ловильных работах/ликвидации аварии.",
    steps: [
      { text: "Заранее предполагать прихват оставшейся части колонны и сложные/опасные условия.", check: "Команда проинструктирована." },
      { text: "Работы ведёт буровой мастер под руководством старшего инженера/мастера по сложным работам (или главного инженера).", check: "Назначение подтверждено." },
      { text: "Перед спуском инструмента проверить: талевый канат, индикатор веса (стрелки/запись), дюритовые шланги, состояние вышки/креплений, фундамент, трансмиссии и тормозную систему лебёдки, стопорные устройства ротора/вертлюга.", check: "Отметка о проверке." },
      { text: "После проверки — только тогда спускать ловильный инструмент.", check: "Последовательность соблюдена." },
    ],
    safety: [
      "При кислотных ваннах: кислотостойкая одежда, маска, резиновые перчатки и сапоги (брюки навыпуск).",
      "При работе с торпедами — руководствоваться едиными правилами безопасности взрывных работ.",
    ],
    source: "Гл.2.7 (техника безопасности при ликвидации аварий)",
  },

  // ============ ГЛАВА 4 (ловильный инструмент — комплектность) ============
  "ch4_minimum_fishing_kit": {
    id: "ch4_minimum_fishing_kit",
    title: "Минимальный комплект ловильного инструмента на буровой (в собранном виде)",
    whenToUse: "Проверка готовности буровой к аварийным работам.",
    steps: [
      { text: "Проверить наличие: ловитель (шлипс) с плашками/манжетами/воронкой.", check: "Есть в наличии." },
      { text: "Проверить наличие: колокол с воронкой.", check: "Есть в наличии." },
      { text: "Проверить наличие: метчик универсальный с центрирующим приспособлением.", check: "Есть в наличии." },
      { text: "Проверить наличие: метчик специальный (калибр).", check: "Есть в наличии." },
      { text: "Проверить наличие: магнитный ловитель с воронкой.", check: "Есть в наличии." },
      { text: "Проверить наличие: забойный фрезер.", check: "Есть в наличии." },
      { text: "Проверить наличие: труболовки под бурильные и утяжелённые трубы.", check: "Есть в наличии." },
      { text: "Убедиться: весь инструмент оснащён переводниками под соединение с бурильными трубами.", check: "Переводники комплектны." },
    ],
    notes: [
      "Диаметр ловильного инструмента должен соответствовать диаметру бурильной колонны; наружный диаметр обычно на 50–60 мм меньше диаметра скважины.",
    ],
    source: "Гл.4.1 (общие положения по эксплуатации ловильного инструмента)",
  },

  // ============ ГЛАВА 5 (поглощения — смеси и доставка) ============
  "ch5_5_mix_requirements": {
    id: "ch5_5_mix_requirements",
    title: "Требования к тампонажным смесям для изоляции зон поглощения",
    whenToUse: "Подбор рецептуры/состава смеси для изоляции поглощения.",
    steps: [
      { text: "Обеспечить текучесть смеси на весь период закачивания и продавки.", check: "Текучесть соответствует времени операции." },
      { text: "Плотность смеси выбрать близкой к плотности бурового раствора.", check: "Плотности согласованы." },
      { text: "Регулировать сроки схватывания/пластическую прочность; начало схватывания — больше времени операции (с запасом).", check: "Заданы сроки схватывания." },
      { text: "Смесь должна быть стабильной при температуре и давлении скважины.", check: "Стабильность подтверждена." },
      { text: "Смесь должна быть устойчивой к разбавлению пластовыми водами.", check: "Устойчивость учтена." },
      { text: "После закачки — быстрое твердение и набор прочности.", check: "Целевые показатели заданы." },
      { text: "Смесь должна быть нетоксичной и недефицитной.", check: "Ограничения проверены." },
    ],
    source: "Гл.5.5 (тампонажные смеси для изоляции зон поглощения)",
  },

  "ch5_6_delivery": {
    id: "ch5_6_delivery",
    title: "Доставка изоляционных смесей в зону поглощения: объём и технология",
    whenToUse: "Планирование закачки смеси для перекрытия каналов поглощения.",
    steps: [
      { text: "Выбрать способ доставки: по стволу, по БТ с пакером/без пакера, желонками/контейнерами.", check: "Способ выбран под условия." },
      { text: "Рассчитать объём смеси: обычно 3–5 крат объёма ствола в интервале пласта; учесть добавку на потери по длине.", check: "Расчёт объёма выполнен." },
      { text: "При работах без пакера — во время цементирования рекомендуется расхаживать БТ на длину квадратной штанги.", check: "Режим расхаживания установлен." },
    ],
    source: "Гл.5.6 (доставка изоляционных смесей)",
  },
};
